<p-toast></p-toast>
<div class="grid">
    <div class="col-12">
        <div class="card shadow-6 border-round-xl bg-gradient-primary">
            <div class="p-4">
                <div class="flex flex-column lg:flex-row justify-content-between align-items-start lg:align-items-center gap-3">
                    <div>
                        <h3 class="text-white mb-2 font-bold">üè¢ Marriage Bureau Details</h3>
                        <p class="text-cyan-200 mb-0">Application ID: <span class="font-semibold text-white">{{requestId}}</span></p>
                        <p class="text-cyan-200 mb-0">Request Type: <span class="font-semibold text-white">{{requestType}}</span></p>
                    </div>
                    <div class="flex flex-column sm:flex-row gap-2 align-items-start sm:align-items-center">
                        <div class="flex gap-2">
                            <p-button label="Approve" icon="pi pi-check-circle" class="p-button-success p-button-lg shadow-4" (click)="approveBureau()"></p-button>
                            <p-button label="Revise" icon="pi pi-pencil" class="p-button-warning p-button-lg shadow-4" (click)="reviseBureau()"></p-button>
                            <p-button label="Reject" icon="pi pi-times-circle" class="p-button-danger p-button-lg shadow-4" (click)="rejectBureau()"></p-button>
                        </div>
                        <div class="bg-white-alpha-20 border-round-lg px-3 py-2 mt-2 sm:mt-0">
                            <div class="flex align-items-center gap-2">
                                <i class="pi pi-clock text-yellow-300"></i>
                                <span class="text-white font-medium">Status:</span>
                                <span class="status-badge status-pending text-sm font-semibold">Pending Verification</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="card border-round-xl shadow-4 bg-white">
            <div class="text-center py-5 px-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px 12px 0 0;">
                <div class="relative inline-block">
                    <img src="assets/demo/images/avatar/amyelsner.png" alt="Marriage Bureau Logo"
                         class="border-circle shadow-6 border-4 border-white"
                         style="width: 120px; height: 120px;" />
                    <div class="absolute bottom-0 right-0 bg-green-500 border-circle border-3 border-white flex align-items-center justify-content-center shadow-4"
                         style="width: 32px; height: 32px;">
                        <i class="pi pi-check text-white text-sm"></i>
                    </div>
                </div>
                <h2 class="text-white mt-3 mb-2 font-bold text-2xl">Happy Marriages Bureau</h2>
                <div class="flex justify-content-center gap-2 mb-3">
                    <span class="badge-verified px-3 py-1 border-round-pill text-sm font-semibold">‚úì Licensed</span>
                    <span class="badge-verified px-3 py-1 border-round-pill text-sm font-semibold">‚úì Verified</span>
                </div>
                <p class="text-cyan-100 mb-0 font-medium">Bringing hearts together since 2009</p>
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="card border-round-xl shadow-4">
            <p-tabView styleClass="tabview-beautiful">
                <!-- Basic Information Tab -->
                <p-tabPanel header="üìã Basic Information">
                    <div class="grid">
                        <div class="col-12 lg:col-6">
                            <div class="bg-pink-50 border-round-lg p-4 mb-4 border-1 border-pink-200">
                                <h5 class="text-pink-700 mb-3 flex align-items-center gap-2">
                                    <i class="pi pi-building text-pink-600"></i>
                                    Bureau Details
                                </h5>
                                <div class="space-y-3">
                                    <div class="flex justify-content-between">
                                        <span class="font-medium text-700">Bureau Name:</span>
                                        <span class="text-900">Happy Marriages Bureau</span>
                                    </div>
                                    <div class="flex justify-content-between">
                                        <span class="font-medium text-700">Owner Name:</span>
                                        <span class="text-900">Rajesh Kumar</span>
                                    </div>
                                    <div class="flex justify-content-between">
                                        <span class="font-medium text-700">Contact:</span>
                                        <span class="text-900">+91-9876543210</span>
                                    </div>
                                    <div class="flex justify-content-between">
                                        <span class="font-medium text-700">Email:</span>
                                        <span class="text-900">info@happymarriages.com</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 lg:col-6">
                            <div class="bg-rose-50 border-round-lg p-4 mb-4 border-1 border-rose-200">
                                <h5 class="text-rose-700 mb-3 flex align-items-center gap-2">
                                    <i class="pi pi-briefcase text-rose-600"></i>
                                    Business Information
                                </h5>
                                <div class="space-y-3">
                                    <div class="flex justify-content-between">
                                        <span class="font-medium text-700">Address:</span>
                                        <span class="text-900">123 Marriage Street, Delhi</span>
                                    </div>
                                    <div class="flex justify-content-between">
                                        <span class="font-medium text-700">Experience:</span>
                                        <span class="text-green-600 font-semibold">15 years</span>
                                    </div>
                                    <div class="flex justify-content-between">
                                        <span class="font-medium text-700">Registration:</span>
                                        <span class="text-900">MB-DEL-2023-001</span>
                                    </div>
                                    <div class="flex justify-content-between">
                                        <span class="font-medium text-700">GST:</span>
                                        <span class="text-900">07AABFH1234H1Z5</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

                <!-- Services Offered Tab -->
                <p-tabPanel header="üíí Services Offered">
                    <div class="services-overview mb-4">
                        <div class="text-center mb-4">
                            <h4 class="text-800 mb-2">Our Comprehensive Marriage Services</h4>
                            <p class="text-600">Professional marriage bureau services tailored to your needs</p>
                        </div>
                    </div>

                    <!-- Marriage Services Section -->
                    <div class="service-section mb-5">
                        <div class="section-header mb-4">
                            <div class="flex align-items-center gap-3 mb-3">
                                <div class="service-icon-wrapper">
                                    <i class="pi pi-heart-fill service-main-icon"></i>
                                </div>
                                <div>
                                    <h5 class="text-800 mb-1">Marriage Ceremony Services</h5>
                                    <p class="text-600 mb-0">Traditional and religious marriage ceremonies</p>
                                </div>
                            </div>
                        </div>

                        <div class="grid">
                            <div class="col-12 md:col-6 lg:col-3" *ngFor="let service of marriageServices">
                                <div class="marriage-service-card" (click)="toggleService(service)">
                                    <div class="service-card-header">
                                        <div class="service-icon" [style.background]="service.color">
                                            <i [class]="service.icon" class="service-card-icon"></i>
                                        </div>
                                        <div class="service-status">
                                            <i class="pi pi-check-circle service-provided-icon" *ngIf="service.provided" title="Service Provided by Bureau"></i>
                                            <i class="pi pi-check-circle service-selected-icon" *ngIf="service.selected && !service.provided" title="Service Selected"></i>
                                        </div>
                                    </div>
                                    <div class="service-card-content">
                                        <div class="service-title-header">
                                            <h6 class="service-title">{{service.name}}</h6>
                                            <span class="service-badge" *ngIf="service.provided">‚úì Provided</span>
                                        </div>
                                        <p class="service-description">{{service.description}}</p>
                                        <div class="service-features">
                                            <span class="feature-badge" *ngFor="let feature of service.features">
                                                {{feature}}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="service-card-footer">
                                        <span class="service-price">{{service.price}}</span>
                                        <span class="service-duration">{{service.duration}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Services Section -->
                    <div class="service-section">
                        <div class="section-header mb-4">
                            <div class="flex align-items-center gap-3 mb-3">
                                <div class="service-icon-wrapper">
                                    <i class="pi pi-star-fill service-main-icon"></i>
                                </div>
                                <div>
                                    <h5 class="text-800 mb-1">Additional Wedding Services</h5>
                                    <p class="text-600 mb-0">Complete wedding planning and support services</p>
                                </div>
                            </div>
                        </div>

                        <div class="grid">
                            <div class="col-12 md:col-6 lg:col-3" *ngFor="let service of additionalServices">
                                <div class="additional-service-card" (click)="toggleService(service)">
                                    <div class="service-card-header">
                                        <div class="service-icon" [style.background]="service.color">
                                            <i [class]="service.icon" class="service-card-icon"></i>
                                        </div>
                                        <div class="service-status">
                                            <i class="pi pi-check-circle service-provided-icon" *ngIf="service.provided" title="Service Provided by Bureau"></i>
                                            <i class="pi pi-check-circle service-selected-icon" *ngIf="service.selected && !service.provided" title="Service Selected"></i>
                                        </div>
                                    </div>
                                    <div class="service-card-content">
                                        <div class="service-title-header">
                                            <h6 class="service-title">{{service.name}}</h6>
                                            <span class="service-badge" *ngIf="service.provided">‚úì Provided</span>
                                        </div>
                                        <p class="service-description">{{service.description}}</p>
                                        <div class="service-rating">
                                            <p-rating [ngModel]="service.rating" [readonly]="true" [cancel]="false" class="service-stars"></p-rating>
                                            <span class="rating-text">({{service.reviews}} reviews)</span>
                                        </div>
                                    </div>
                                    <div class="service-card-footer">
                                        <span class="service-price">{{service.price}}</span>
                                        <p-button label="Book Now" icon="pi pi-calendar" class="p-button-sm p-button-outlined" (click)="bookService(service)"></p-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Summary -->
                    <div class="service-summary mt-5">
                        <div class="summary-card">
                            <div class="grid">
                                <div class="col-12 md:col-4">
                                    <div class="summary-item">
                                        <div class="summary-icon">
                                            <i class="pi pi-users"></i>
                                        </div>
                                        <div class="summary-content">
                                            <h6 class="summary-title">Happy Couples</h6>
                                            <span class="summary-value">2,500+</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 md:col-4">
                                    <div class="summary-item">
                                        <div class="summary-icon">
                                            <i class="pi pi-star"></i>
                                        </div>
                                        <div class="summary-content">
                                            <h6 class="summary-title">Average Rating</h6>
                                            <span class="summary-value">4.8/5</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 md:col-4">
                                    <div class="summary-item">
                                        <div class="summary-icon">
                                            <i class="pi pi-clock"></i>
                                        </div>
                                        <div class="summary-content">
                                            <h6 class="summary-title">Years of Service</h6>
                                            <span class="summary-value">15+</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

                <!-- Documents & Licenses Tab -->
                <p-tabPanel header="üìÑ Documents & Licenses">
                    <div class="grid">
                        <div class="col-12">
                            <div class="bg-light border-round-lg p-4 mb-4">
                                <h5 class="text-800 mb-4 flex align-items-center gap-2">
                                    <i class="pi pi-file-pdf text-red-500"></i>
                                    Verification Documents
                                </h5>
                                <div class="grid">
                                    <div class="col-12 md:col-6 lg:col-3" *ngFor="let doc of documents">
                                        <div class="document-card bg-white border-round-lg p-3 shadow-2 hover:shadow-4 cursor-pointer transition-all transition-duration-300 border-1 border-200">
                                            <div class="flex align-items-center gap-3 mb-3">
                                                <div class="document-icon bg-blue-100 border-round-lg p-2">
                                                    <i class="pi pi-file-pdf text-blue-600 text-lg"></i>
                                                </div>
                                                <div class="flex-1">
                                                    <h6 class="text-900 mb-1 font-semibold text-sm">{{doc.name}}</h6>
                                                    <p class="text-600 mb-0 text-xs">{{doc.status}}</p>
                                                </div>
                                            </div>
                                            <div class="flex justify-content-between align-items-center mb-2">
                                                <small class="text-600">Uploaded: {{doc.date}}</small>
                                            </div>
                                            <div class="flex gap-1">
                                                <p-button icon="pi pi-eye" label="View" class="p-button-text p-button-sm p-button-info" (click)="viewDocument(doc.name)"></p-button>
                                                <p-button icon="pi pi-download" label="Download" class="p-button-text p-button-sm p-button-success" (click)="downloadDocument(doc.name)"></p-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

                <!-- Reviews & Ratings Tab -->
                <p-tabPanel header="‚≠ê Reviews & Ratings">
                    <!-- Overall Rating Section -->
                    <div class="rating-overview-section mb-5">
                        <div class="rating-header text-center mb-4">
                            <h4 class="text-800 mb-2">Customer Reviews & Ratings</h4>
                            <p class="text-600 mb-0">See what our satisfied customers are saying</p>
                        </div>

                        <div class="grid">
                            <div class="col-12 lg:col-4">
                                <div class="overall-rating-card">
                                    <div class="rating-display">
                                        <div class="rating-number">
                                            <span class="rating-value">4.8</span>
                                            <span class="rating-max">/5</span>
                                        </div>
                                        <div class="rating-stars">
                                            <p-rating [ngModel]="rating" [readonly]="true" [cancel]="false" class="rating-stars-component"></p-rating>
                                        </div>
                                        <div class="rating-text">
                                            <span class="rating-label">Excellent Service</span>
                                            <span class="rating-count">Based on 256 reviews</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 lg:col-8">
                                <div class="rating-breakdown">
                                    <h6 class="breakdown-title">Rating Breakdown</h6>
                                    <div class="rating-bars">
                                        <div class="rating-bar-item" *ngFor="let bar of ratingBreakdown">
                                            <div class="rating-bar-label">
                                                <span class="stars-count">{{bar.stars}} ‚òÖ</span>
                                                <span class="percentage">{{bar.percentage}}%</span>
                                            </div>
                                            <div class="rating-bar-container">
                                                <div class="rating-bar-fill" [style.width.%]="bar.percentage"></div>
                                            </div>
                                            <span class="rating-count">({{bar.count}})</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Reviews Section -->
                    <div class="reviews-section">
                        <div class="reviews-header mb-4">
                            <h5 class="reviews-title">Recent Customer Reviews</h5>
                            <div class="reviews-filter">
                                <p-dropdown [options]="reviewFilters" [(ngModel)]="selectedFilter" placeholder="Filter reviews" class="filter-dropdown" (onChange)="onFilterChange()"></p-dropdown>
                            </div>
                        </div>

                        <div class="reviews-grid">
                            <div class="review-card" *ngFor="let review of filteredReviews; trackBy: trackByReviewId">
                                <div class="review-header">
                                    <div class="reviewer-info">
                                        <div class="reviewer-avatar">
                                            <div class="avatar-circle">
                                                <span class="avatar-text">{{getInitials(review.customer)}}</span>
                                            </div>
                                        </div>
                                        <div class="reviewer-details">
                                            <h6 class="reviewer-name">{{review.customer}}</h6>
                                            <div class="review-meta">
                                                <p-rating [ngModel]="review.rating" [readonly]="true" [cancel]="false" class="review-stars"></p-rating>
                                                <span class="review-date">{{review.date}}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="review-badges">
                                        <span class="verified-badge" *ngIf="review.verified">
                                            <i class="pi pi-shield"></i>
                                            Verified
                                        </span>
                                        <span class="helpful-badge" *ngIf="review.helpful && review.helpful > 0">
                                            <i class="pi pi-thumbs-up"></i>
                                            {{review.helpful}} found helpful
                                        </span>
                                    </div>
                                </div>

                                <div class="review-content">
                                    <p class="review-text">{{review.comment}}</p>
                                    <div class="review-service" *ngIf="review.service">
                                        <span class="service-tag">{{review.service}}</span>
                                    </div>
                                </div>

                                <div class="review-actions">
                                    <button class="action-btn helpful-btn" (click)="markHelpful(review)">
                                        <i class="pi pi-thumbs-up"></i>
                                        Helpful ({{review.helpful ?? 0}})
                                    </button>
                                    <button class="action-btn reply-btn" (click)="showReply(review)">
                                        <i class="pi pi-reply"></i>
                                        Reply
                                    </button>
                                </div>

                                <!-- Bureau Reply -->
                                <div class="bureau-reply" *ngIf="review.bureauReply">
                                    <div class="reply-header">
                                        <div class="bureau-avatar">
                                            <div class="avatar-circle bureau">
                                                <span class="avatar-text">B</span>
                                            </div>
                                        </div>
                                        <div class="reply-info">
                                            <span class="bureau-name">Happy Marriages Bureau</span>
                                            <span class="reply-date">{{review.bureauReply.date}}</span>
                                        </div>
                                    </div>
                                    <p class="reply-text">{{review.bureauReply.text}}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Load More Reviews -->
                        <div class="load-more-section" *ngIf="hasMoreReviews">
                            <p-button label="Load More Reviews" icon="pi pi-plus" class="load-more-btn" (click)="loadMoreReviews()"></p-button>
                        </div>
                    </div>
                </p-tabPanel>

                <!-- Verification History Tab -->
                <p-tabPanel header="üìä Verification History">
                    <div class="grid">
                        <div class="col-12">
                            <div class="timeline-container bg-light border-round-lg p-4">
                                <h5 class="text-800 mb-4 flex align-items-center gap-2">
                                    <i class="pi pi-clock text-green-600"></i>
                                    Application Timeline
                                </h5>
                                <p-timeline [value]="verificationHistory" align="alternate" styleClass="custom-timeline">
                                    <ng-template pTemplate="marker" let-event>
                                        <div class="timeline-marker" [ngClass]="{
                                            'bg-blue-500': event.status.includes('Application'),
                                            'bg-orange-500': event.status.includes('Document'),
                                            'bg-purple-500': event.status.includes('Background'),
                                            'bg-green-500': event.status.includes('Final')
                                        }">
                                            <i class="pi" [ngClass]="{
                                                'pi-file': event.status.includes('Application'),
                                                'pi-check-circle': event.status.includes('Document'),
                                                'pi-user': event.status.includes('Background'),
                                                'pi-verified': event.status.includes('Final')
                                            }"></i>
                                        </div>
                                    </ng-template>
                                    <ng-template pTemplate="content" let-event>
                                        <div class="timeline-content bg-white border-round-lg p-3 shadow-2 border-1 border-200">
                                            <div class="flex justify-content-between align-items-center mb-2">
                                                <h6 class="text-900 mb-0 font-semibold">{{event.status}}</h6>
                                                <span class="status-badge" [ngClass]="{
                                                    'status-pending': event.status.includes('Application'),
                                                    'status-verified': event.status.includes('Document') || event.status.includes('Final'),
                                                    'status-processing': event.status.includes('Background')
                                                }">{{event.status.includes('Final') ? 'Approved' : 'Completed'}}</span>
                                            </div>
                                            <p class="text-700 mb-2">{{event.description}}</p>
                                            <div class="flex justify-content-between align-items-center">
                                                <small class="text-600">
                                                    <i class="pi pi-user mr-1"></i>
                                                    Verified by: <strong>{{event.verifiedBy}}</strong>
                                                </small>
                                                <small class="text-500">{{event.time}}</small>
                                            </div>
                                        </div>
                                    </ng-template>
                                    <ng-template pTemplate="opposite" let-event>
                                        <div class="timeline-date bg-primary text-white border-round-pill px-3 py-1 text-sm font-semibold shadow-1">
                                            {{event.date}}
                                        </div>
                                    </ng-template>
                                </p-timeline>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

                <!-- Chat with Bureau User Tab -->
                <p-tabPanel header="üí¨ Chat with Bureau User">
                    <div class="grid">
                        <div class="col-12">
                            <div class="chat-container bg-light border-round-lg p-4" style="height: 500px; overflow-y: auto;">
                                <div class="chat-messages" style="display: flex; flex-direction: column; gap: 1rem;">
                                    <!-- Chat messages -->
                                    <div class="message-wrapper" *ngFor="let message of chatMessages; let i = index">
                                        <div class="message" [ngClass]="{'sent': message.sender === 'admin', 'received': message.sender === 'bureau'}">
                                            <div class="message-content">
                                                <div class="message-text">{{message.text}}</div>
                                                <div class="message-time">{{message.time}}</div>
                                            </div>
                                            <div class="message-avatar">
                                                <div class="avatar-circle" [ngClass]="{'admin-avatar': message.sender === 'admin', 'bureau-avatar': message.sender === 'bureau'}">
                                                    {{message.sender === 'admin' ? 'A' : 'B'}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Chat input -->
                            <div class="chat-input mt-3">
                                <div class="p-inputgroup">
                                    <input pInputText
                                           [(ngModel)]="newMessage"
                                           placeholder="Type your message here..."
                                           (keyup.enter)="sendMessage()"
                                           class="flex-1" />
                                    <button pButton
                                            type="button"
                                            icon="pi pi-send"
                                            class="p-button-primary"
                                            (click)="sendMessage()"
                                            [disabled]="!newMessage?.trim()">
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>
            </p-tabView>
        </div>
    </div>
</div>
